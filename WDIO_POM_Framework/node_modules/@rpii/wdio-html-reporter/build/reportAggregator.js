"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _htmlGenerator = _interopRequireDefault(require("./htmlGenerator"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const open = require('open');

let copyfiles = require("copyfiles");

const fs = require('fs-extra');

const path = require('path');

const moment = require('moment');

const logger = require('@log4js-node/log4js-api');

function walk(dir, extensions, filelist = []) {
  const files = fs.readdirSync(dir);
  files.forEach(function (file) {
    const filepath = path.join(dir, file);
    const stat = fs.statSync(filepath);

    if (stat.isDirectory()) {
      filelist = walk(filepath, extensions, filelist);
    } else {
      extensions.forEach(function (extension) {
        if (file.indexOf(extension) == file.length - extension.length) {
          filelist.push(filepath);
        }
      });
    }
  });
  return filelist;
}

class ReportAggregator {
  constructor(opts) {
    opts = Object.assign({}, {
      outputDir: 'reports/html-reports/',
      filename: 'master-report.html',
      reportTitle: 'Test Master Report',
      showInBrowser: false,
      templateFilename: path.resolve(__dirname, '../templates/wdio-html-reporter-template.hbs'),
      templateFuncs: {},
      browserName: "not specified",
      LOG: null
    }, opts);
    this.options = opts;

    if (!this.options.LOG) {
      this.options.LOG = logger.getLogger("default");
    }

    this.options.reportFile = path.join(process.cwd(), this.options.outputDir, this.options.filename);
    this.reports = [];
  }

  clean() {
    fs.emptyDirSync(this.options.outputDir);
  }

  readJsonFiles() {
    return walk(this.options.outputDir, [".json"]);
  }

  log(message, object) {
    if (this.options.LOG) {
      this.options.LOG.debug(message + object);
    }
  }

  async createReport() {
    if (this.options.LOG) {
      this.options.LOG.debug("Report Aggregation started");
    }

    let metrics = {
      passed: 0,
      skipped: 0,
      failed: 0,
      start: new moment(),
      end: new moment(),
      duration: 0
    };
    let suites = [];
    let specs = [];
    let files = this.readJsonFiles();

    for (let i = 0; i < files.length; i++) {
      try {
        let filename = files[i];
        let report = JSON.parse(fs.readFileSync(filename));

        if (!report.info || !report.info.specs) {
          this.options.LOG.error("report structure in question, no info or info.specs ", JSON.stringify(report));
          this.options.LOG.info("report content: ", JSON.stringify(report));
        }

        report.info.specs.forEach(spec => {
          specs.push(spec);
        });
        this.reports.push(report);
        metrics.passed += report.metrics.passed;
        metrics.failed += report.metrics.failed;
        metrics.skipped += report.metrics.skipped;

        for (let k = 0; k < report.suites.length; k++) {
          let suite = report.suites[k];
          let start = moment.utc(suite.start);

          if (start.isSameOrBefore(metrics.start)) {
            metrics.start = start;
          }

          let end = moment.utc(suite.end);

          if (end.isAfter(metrics.end)) {
            metrics.end = end;
          }

          suites.push(suite);
        }
      } catch (ex) {
        console.error(ex);
      }
    }

    if (!this.reports || !this.reports.length) {
      // the test failed hard at the beginning.  Create a dummy structure to get through html generation
      let report = {
        "info": {
          "cid": "The execution of the test suite has failed before report generation was started.  Please look at the logs to determine the error, this is likely an issue with your configuration files.",
          "config": {
            "hostname": "localhost"
          },
          "specs": [],
          "suites": [{
            "uid": "Test Start Failure",
            "title": "Test Start Failure",
            "type": "suite",
            "tests": []
          }]
        }
      };
      this.reports = [];
      this.reports.push(report);
    }

    let duration = metrics.end.diff(metrics.start);
    metrics.duration = moment.duration(duration, "milliseconds").format('hh:mm:ss.SS', {
      trim: false
    });
    metrics.start = metrics.start.format();
    metrics.end = metrics.end.format();
    const reportOptions = {
      data: {
        info: this.reports[0].info,
        specs: specs,
        metrics: metrics,
        suites: suites,
        title: this.options.reportTitle,
        browserName: this.options.browserName
      },
      outputDir: this.options.outputDir,
      reportFile: this.options.reportFile,
      templateFilename: this.options.templateFilename,
      LOG: this.options.LOG,
      templateFuncs: this.options.templateFuncs,
      showInBrowser: this.options.showInBrowser
    };

    if (this.options.LOG) {
      this.options.LOG.debug("Aggregated " + specs.length + " specs, " + suites.length + " suites, " + this.reports.length + " reports, ");
    }

    _htmlGenerator.default.htmlOutput(reportOptions);

    reportOptions.LOG.debug("Report Aggregation completed");
    let jsFiles = path.join(__dirname, '..//templates/*.js');
    let reportDir = path.join(process.cwd(), this.options.outputDir);
    copyfiles([jsFiles, reportDir], true, () => {
      reportOptions.LOG.info('copyfiles complete : ' + jsFiles + " to " + reportDir);

      try {
        if (this.options.showInBrowser) {
          let childProcess = open(this.options.reportFile);
          childProcess.then(() => {
            reportOptions.LOG.info('browser launched');
          }, error => {
            reportOptions.LOG.error('showInBrowser error spawning :' + this.options.reportFile + " " + error.toString());
          });
        }
      } catch (ex) {
        reportOptions.LOG.error('Error opening browser:' + ex);
      }
    });
  }

}

var _default = ReportAggregator;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBvcnRBZ2dyZWdhdG9yLmpzIl0sIm5hbWVzIjpbIm9wZW4iLCJyZXF1aXJlIiwiY29weWZpbGVzIiwiZnMiLCJwYXRoIiwibW9tZW50IiwibG9nZ2VyIiwid2FsayIsImRpciIsImV4dGVuc2lvbnMiLCJmaWxlbGlzdCIsImZpbGVzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZSIsImZpbGVwYXRoIiwiam9pbiIsInN0YXQiLCJzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiZXh0ZW5zaW9uIiwiaW5kZXhPZiIsImxlbmd0aCIsInB1c2giLCJSZXBvcnRBZ2dyZWdhdG9yIiwiY29uc3RydWN0b3IiLCJvcHRzIiwiT2JqZWN0IiwiYXNzaWduIiwib3V0cHV0RGlyIiwiZmlsZW5hbWUiLCJyZXBvcnRUaXRsZSIsInNob3dJbkJyb3dzZXIiLCJ0ZW1wbGF0ZUZpbGVuYW1lIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInRlbXBsYXRlRnVuY3MiLCJicm93c2VyTmFtZSIsIkxPRyIsIm9wdGlvbnMiLCJnZXRMb2dnZXIiLCJyZXBvcnRGaWxlIiwicHJvY2VzcyIsImN3ZCIsInJlcG9ydHMiLCJjbGVhbiIsImVtcHR5RGlyU3luYyIsInJlYWRKc29uRmlsZXMiLCJsb2ciLCJtZXNzYWdlIiwib2JqZWN0IiwiZGVidWciLCJjcmVhdGVSZXBvcnQiLCJtZXRyaWNzIiwicGFzc2VkIiwic2tpcHBlZCIsImZhaWxlZCIsInN0YXJ0IiwiZW5kIiwiZHVyYXRpb24iLCJzdWl0ZXMiLCJzcGVjcyIsImkiLCJyZXBvcnQiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJpbmZvIiwiZXJyb3IiLCJzdHJpbmdpZnkiLCJzcGVjIiwiayIsInN1aXRlIiwidXRjIiwiaXNTYW1lT3JCZWZvcmUiLCJpc0FmdGVyIiwiZXgiLCJjb25zb2xlIiwiZGlmZiIsImZvcm1hdCIsInRyaW0iLCJyZXBvcnRPcHRpb25zIiwiZGF0YSIsInRpdGxlIiwiSHRtbEdlbmVyYXRvciIsImh0bWxPdXRwdXQiLCJqc0ZpbGVzIiwicmVwb3J0RGlyIiwiY2hpbGRQcm9jZXNzIiwidGhlbiIsInRvU3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7OztBQUNBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsSUFBSUMsU0FBUyxHQUFHRCxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFFQSxNQUFNRSxFQUFFLEdBQUdGLE9BQU8sQ0FBQyxVQUFELENBQWxCOztBQUNBLE1BQU1HLElBQUksR0FBR0gsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUksTUFBTSxHQUFHSixPQUFPLENBQUMsUUFBRCxDQUF0Qjs7QUFDQSxNQUFNSyxNQUFNLEdBQUdMLE9BQU8sQ0FBQyx5QkFBRCxDQUF0Qjs7QUFFQSxTQUFVTSxJQUFWLENBQWVDLEdBQWYsRUFBb0JDLFVBQXBCLEVBQWlDQyxRQUFRLEdBQUcsRUFBNUMsRUFBZ0Q7QUFDNUMsUUFBTUMsS0FBSyxHQUFHUixFQUFFLENBQUNTLFdBQUgsQ0FBZUosR0FBZixDQUFkO0FBRUFHLEVBQUFBLEtBQUssQ0FBQ0UsT0FBTixDQUFjLFVBQVVDLElBQVYsRUFBZ0I7QUFDMUIsVUFBTUMsUUFBUSxHQUFHWCxJQUFJLENBQUNZLElBQUwsQ0FBVVIsR0FBVixFQUFlTSxJQUFmLENBQWpCO0FBQ0EsVUFBTUcsSUFBSSxHQUFHZCxFQUFFLENBQUNlLFFBQUgsQ0FBWUgsUUFBWixDQUFiOztBQUVBLFFBQUlFLElBQUksQ0FBQ0UsV0FBTCxFQUFKLEVBQXdCO0FBQ3BCVCxNQUFBQSxRQUFRLEdBQUdILElBQUksQ0FBQ1EsUUFBRCxFQUFXTixVQUFYLEVBQXVCQyxRQUF2QixDQUFmO0FBQ0gsS0FGRCxNQUVPO0FBQ0hELE1BQUFBLFVBQVUsQ0FBQ0ksT0FBWCxDQUFtQixVQUFVTyxTQUFWLEVBQXFCO0FBQ3BDLFlBQUlOLElBQUksQ0FBQ08sT0FBTCxDQUFhRCxTQUFiLEtBQTJCTixJQUFJLENBQUNRLE1B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S0FBSyxDQUFDc0IsUUFBTixFQUEzRjtBQUNILFdBTkw7QUFPSDtBQUNKLE9BWkQsQ0FZRSxPQUFPZCxFQUFQLEVBQVc7QUFDVEssUUFBQUEsYUFBYSxDQUFDM0MsR0FBZCxDQUFrQjhCLEtBQWxCLENBQXdCLDJCQUEyQlEsRUFBbkQ7QUFDSDtBQUNKLEtBbEJJLENBQVQ7QUFxQkg7O0FBbEtrQjs7ZUF1S1JwRCxnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIdG1sR2VuZXJhdG9yIGZyb20gXCIuL2h0bWxHZW5lcmF0b3JcIjtcclxuY29uc3Qgb3BlbiA9IHJlcXVpcmUoJ29wZW4nKTtcclxubGV0IGNvcHlmaWxlcyA9IHJlcXVpcmUoXCJjb3B5ZmlsZXNcIik7XHJcblxyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzLWV4dHJhJyk7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCdAbG9nNGpzLW5vZGUvbG9nNGpzLWFwaScpO1xyXG5cclxuZnVuY3Rpb24gIHdhbGsoZGlyLCBleHRlbnNpb25zICwgZmlsZWxpc3QgPSBbXSkge1xyXG4gICAgY29uc3QgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhkaXIpO1xyXG5cclxuICAgIGZpbGVzLmZvckVhY2goZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICBjb25zdCBmaWxlcGF0aCA9IHBhdGguam9pbihkaXIsIGZpbGUpO1xyXG4gICAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhmaWxlcGF0aCk7XHJcblxyXG4gICAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcclxuICAgICAgICAgICAgZmlsZWxpc3QgPSB3YWxrKGZpbGVwYXRoLCBleHRlbnNpb25zLCBmaWxlbGlzdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZXh0ZW5zaW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChleHRlbnNpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWxlLmluZGV4T2YoZXh0ZW5zaW9uKSA9PSBmaWxlLmxlbmd0aCAtIGV4dGVuc2lvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlbGlzdC5wdXNoKGZpbGVwYXRoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGZpbGVsaXN0O1xyXG59XHJcblxyXG5jbGFzcyBSZXBvcnRBZ2dyZWdhdG9yIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRzKSB7XHJcbiAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIHtcclxuICAgICAgICAgICAgb3V0cHV0RGlyOiAncmVwb3J0cy9odG1sLXJlcG9ydHMvJyxcclxuICAgICAgICAgICAgZmlsZW5hbWU6ICdtYXN0ZXItcmVwb3J0Lmh0bWwnLFxyXG4gICAgICAgICAgICByZXBvcnRUaXRsZTogJ1Rlc3QgTWFzdGVyIFJlcG9ydCcsXHJcbiAgICAgICAgICAgIHNob3dJbkJyb3dzZXI6IGZhbHNlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGVuYW1lOiBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vdGVtcGxhdGVzL3dkaW8taHRtbC1yZXBvcnRlci10ZW1wbGF0ZS5oYnMnKSxcclxuICAgICAgICAgICAgdGVtcGxhdGVGdW5jczoge30sXHJcbiAgICAgICAgICAgIGJyb3dzZXJOYW1lOiBcIm5vdCBzcGVjaWZpZWRcIixcclxuICAgICAgICAgICAgTE9HOiBudWxsXHJcbiAgICAgICAgfSwgb3B0cyk7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0cztcclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRyA9IGxvZ2dlci5nZXRMb2dnZXIoXCJkZWZhdWx0XCIpICAgICAgO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9wdGlvbnMucmVwb3J0RmlsZSA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLm9wdGlvbnMub3V0cHV0RGlyLCB0aGlzLm9wdGlvbnMuZmlsZW5hbWUpO1xyXG4gICAgICAgIHRoaXMucmVwb3J0cyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFuKCkge1xyXG4gICAgICAgIGZzLmVtcHR5RGlyU3luYyh0aGlzLm9wdGlvbnMub3V0cHV0RGlyKTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHJlYWRKc29uRmlsZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHdhbGsodGhpcy5vcHRpb25zLm91dHB1dERpciwgW1wiLmpzb25cIl0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBsb2cobWVzc2FnZSxvYmplY3QpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLkxPRykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmRlYnVnKG1lc3NhZ2UgKyBvYmplY3QpIDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBjcmVhdGVSZXBvcnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5MT0cpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5kZWJ1ZyhcIlJlcG9ydCBBZ2dyZWdhdGlvbiBzdGFydGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbWV0cmljcyA9IHtcclxuICAgICAgICAgICAgcGFzc2VkOiAwLFxyXG4gICAgICAgICAgICBza2lwcGVkOiAwLFxyXG4gICAgICAgICAgICBmYWlsZWQ6IDAsXHJcbiAgICAgICAgICAgIHN0YXJ0IDogbmV3IG1vbWVudCgpLFxyXG4gICAgICAgICAgICBlbmQgOiBuZXcgbW9tZW50KCksXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgc3VpdGVzID0gW107XHJcbiAgICAgICAgbGV0IHNwZWNzID0gW107XHJcblxyXG4gICAgICAgIGxldCBmaWxlcyA9IHRoaXMucmVhZEpzb25GaWxlcygpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsZW5hbWUgPSBmaWxlc1tpXTtcclxuICAgICAgICAgICAgICAgIGxldCByZXBvcnQgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhmaWxlbmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXBvcnQuaW5mbyB8fCAhcmVwb3J0LmluZm8uc3BlY3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuTE9HLmVycm9yKFwicmVwb3J0IHN0cnVjdHVyZSBpbiBxdWVzdGlvbiwgbm8gaW5mbyBvciBpbmZvLnNwZWNzIFwiICwgSlNPTi5zdHJpbmdpZnkocmVwb3J0KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLkxPRy5pbmZvKFwicmVwb3J0IGNvbnRlbnQ6IFwiICwgSlNPTi5zdHJpbmdpZnkocmVwb3J0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXBvcnQuaW5mby5zcGVjcy5mb3JFYWNoKChzcGVjKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BlY3MucHVzaChzcGVjKSA7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvcnRzLnB1c2gocmVwb3J0KTtcclxuICAgICAgICAgICAgICAgIG1ldHJpY3MucGFzc2VkICs9IHJlcG9ydC5tZXRyaWNzLnBhc3NlZDtcclxuICAgICAgICAgICAgICAgIG1ldHJpY3MuZmFpbGVkICs9IHJlcG9ydC5tZXRyaWNzLmZhaWxlZDtcclxuICAgICAgICAgICAgICAgIG1ldHJpY3Muc2tpcHBlZCArPSByZXBvcnQubWV0cmljcy5za2lwcGVkO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgcmVwb3J0LnN1aXRlcy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdWl0ZSA9IHJlcG9ydC5zdWl0ZXNba10gO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFydCA9IG1vbWVudC51dGMoc3VpdGUuc3RhcnQpIDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXJ0LmlzU2FtZU9yQmVmb3JlKG1ldHJpY3Muc3RhcnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY3Muc3RhcnQgPSAgc3RhcnQgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsZXQgZW5kID0gbW9tZW50LnV0YyhzdWl0ZS5lbmQpIDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGVuZC5pc0FmdGVyKG1ldHJpY3MuZW5kKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLmVuZCA9ICBlbmQgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzdWl0ZXMucHVzaChzdWl0ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV4KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlcG9ydHMgfHwgIXRoaXMucmVwb3J0cy5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSB0ZXN0IGZhaWxlZCBoYXJkIGF0IHRoZSBiZWdpbm5pbmcuICBDcmVhdGUgYSBkdW1teSBzdHJ1Y3R1cmUgdG8gZ2V0IHRocm91Z2ggaHRtbCBnZW5lcmF0aW9uXHJcbiAgICAgICAgICAgIGxldCByZXBvcnQgPSB7XHJcbiAgICAgICAgICAgICAgICBcImluZm9cIiA6IHtcclxuICAgICAgICAgICAgICAgICAgICBcImNpZFwiOiBcIlRoZSBleGVjdXRpb24gb2YgdGhlIHRlc3Qgc3VpdGUgaGFzIGZhaWxlZCBiZWZvcmUgcmVwb3J0IGdlbmVyYXRpb24gd2FzIHN0YXJ0ZWQuICBQbGVhc2UgbG9vayBhdCB0aGUgbG9ncyB0byBkZXRlcm1pbmUgdGhlIGVycm9yLCB0aGlzIGlzIGxpa2VseSBhbiBpc3N1ZSB3aXRoIHlvdXIgY29uZmlndXJhdGlvbiBmaWxlcy5cIixcclxuICAgICAgICAgICAgICAgICAgICBcImNvbmZpZ1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaG9zdG5hbWVcIjogXCJsb2NhbGhvc3RcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcInNwZWNzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgXCJzdWl0ZXNcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1aWRcIjogXCJUZXN0IFN0YXJ0IEZhaWx1cmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlRlc3QgU3RhcnQgRmFpbHVyZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJzdWl0ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRlc3RzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3J0cyA9IFtdIDtcclxuICAgICAgICAgICAgdGhpcy5yZXBvcnRzLnB1c2gocmVwb3J0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBkdXJhdGlvbiA9IG1ldHJpY3MuZW5kLmRpZmYobWV0cmljcy5zdGFydCkgO1xyXG4gICAgICAgIG1ldHJpY3MuZHVyYXRpb24gPSBtb21lbnQuZHVyYXRpb24oZHVyYXRpb24sIFwibWlsbGlzZWNvbmRzXCIpLmZvcm1hdCgnaGg6bW06c3MuU1MnLCB7dHJpbTogZmFsc2V9KTtcclxuICAgICAgICBtZXRyaWNzLnN0YXJ0ID0gbWV0cmljcy5zdGFydC5mb3JtYXQoKSA7XHJcbiAgICAgICAgbWV0cmljcy5lbmQgPSBtZXRyaWNzLmVuZC5mb3JtYXQoKSA7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlcG9ydE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIGluZm86IHRoaXMucmVwb3J0c1swXS5pbmZvLFxyXG4gICAgICAgICAgICAgICAgc3BlY3M6c3BlY3MsXHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzOiBtZXRyaWNzLFxyXG4gICAgICAgICAgICAgICAgc3VpdGVzOiBzdWl0ZXMsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5vcHRpb25zLnJlcG9ydFRpdGxlLFxyXG4gICAgICAgICAgICAgICAgYnJvd3Nlck5hbWU6IHRoaXMub3B0aW9ucy5icm93c2VyTmFtZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvdXRwdXREaXI6IHRoaXMub3B0aW9ucy5vdXRwdXREaXIsXHJcbiAgICAgICAgICAgIHJlcG9ydEZpbGU6IHRoaXMub3B0aW9ucy5yZXBvcnRGaWxlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGVuYW1lOiB0aGlzLm9wdGlvbnMudGVtcGxhdGVGaWxlbmFtZSxcclxuICAgICAgICAgICAgTE9HIDogdGhpcy5vcHRpb25zLkxPRyxcclxuICAgICAgICAgICAgdGVtcGxhdGVGdW5jczogdGhpcy5vcHRpb25zLnRlbXBsYXRlRnVuY3MsXHJcbiAgICAgICAgICAgIHNob3dJbkJyb3dzZXI6IHRoaXMub3B0aW9ucy5zaG93SW5Ccm93c2VyLFxyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuTE9HKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5MT0cuZGVidWcoXCJBZ2dyZWdhdGVkIFwiICsgc3BlY3MubGVuZ3RoICsgXCIgc3BlY3MsIFwiICsgc3VpdGVzLmxlbmd0aCArIFwiIHN1aXRlcywgXCIgKyB0aGlzLnJlcG9ydHMubGVuZ3RoICsgXCIgcmVwb3J0cywgXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBIdG1sR2VuZXJhdG9yLmh0bWxPdXRwdXQocmVwb3J0T3B0aW9ucyk7XHJcbiAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuZGVidWcoXCJSZXBvcnQgQWdncmVnYXRpb24gY29tcGxldGVkXCIpO1xyXG4gICAgICAgIGxldCBqc0ZpbGVzID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy90ZW1wbGF0ZXMvKi5qcycpO1xyXG4gICAgICAgIGxldCByZXBvcnREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy5vcHRpb25zLm91dHB1dERpcik7XHJcbiAgICAgICAgY29weWZpbGVzKCBbanNGaWxlcywgcmVwb3J0RGlyXSAsIHRydWUsXHJcbiAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlcG9ydE9wdGlvbnMuTE9HLmluZm8oICdjb3B5ZmlsZXMgY29tcGxldGUgOiAnICsganNGaWxlcyAgKyBcIiB0byBcIiArIHJlcG9ydERpcikgO1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNob3dJbkJyb3dzZXIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaGlsZFByb2Nlc3MgPSBvcGVuKHRoaXMub3B0aW9ucy5yZXBvcnRGaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0T3B0aW9ucy5MT0cuaW5mbygnYnJvd3NlciBsYXVuY2hlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydE9wdGlvbnMuTE9HLmVycm9yKCdzaG93SW5Ccm93c2VyIGVycm9yIHNwYXduaW5nIDonICsgdGhpcy5vcHRpb25zLnJlcG9ydEZpbGUgKyBcIiBcIiArIGVycm9yLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcG9ydE9wdGlvbnMuTE9HLmVycm9yKCdFcnJvciBvcGVuaW5nIGJyb3dzZXI6JyArIGV4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuXHJcbiAgICB9XHJcblxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUmVwb3J0QWdncmVnYXRvcjtcclxuIl19